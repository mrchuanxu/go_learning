## Golang defer è¿™è¯¥æ­»çš„æ¸©æŸ”
Deferæ˜¯Goè¯­è¨€æä¾›çš„ä¸€ç§ç”¨äºæ³¨å†Œå»¶è¿Ÿè°ƒç”¨çš„æœºåˆ¶: è®©å‡½æ•°æˆ–è¯­å¥å¯ä»¥åœ¨å½“å‰å‡½æ•°æ‰§è¡Œå®Œæ¯•å(åŒ…æ‹¬é€šè¿‡returnæ­£å¸¸ç»“æŸæˆ–è€…panicå¯¼è‡´å¼‚å¸¸ç»“æŸ)æ‰§è¡Œã€‚æ·±å—Goå¼€å‘è€…çš„æ¬¢è¿ã€‚<br>

#### ä»€ä¹ˆæ˜¯deferï¼Ÿ
deferè¯­å¥é€šå¸¸ç”¨äºä¸€äº›æˆå¯¹æ“ä½œçš„åœºæ™¯:æ‰“å¼€é“¾æ¥/å…³é—­é“¾æ¥ï¼›æ‰“å¼€æ–‡ä»¶/å…³é—­æ–‡ä»¶ç­‰<br>

deferåœ¨ä¸€äº›éœ€è¦å›æ”¶èµ„æºçš„åœºæ™¯éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨å‡½æ•°ç»“æŸå‰åšä¸€äº›æ¸…ç†æ“ä½œã€‚åœ¨æ‰“å¼€èµ„æºè¯­å¥çš„ä¸‹ä¸€è¡Œï¼Œå¯ä»¥ç›´æ¥ä¸€å¥deferå°±å¯ä»¥åœ¨å‡½æ•°è¿”å›é’±å…³é—­èµ„æºï¼Œå¯è°“ç›¸å½“ä¼˜é›…ã€‚<br>
```go
	f,err := os.Open("hello.txt")
	check(err)
	b1 := make([]byte,10)
	n1,err := f.Read(b1)
	check(err)
	fmt.Printf("%d bytes: %s\n", n1, string(b1[:n1]))
	defer func(){
		f.Close()
	}()
```
å…ˆåˆ¤æ–­errï¼Œéœ€è¦åˆ¤æ–­ æ‰€ä»¥å†™äº†ä¸€ä¸ªcheckï¼Œé”™äº†å°±ç›´æ¥panic
#### ä¸ºä»€ä¹ˆéœ€è¦deferï¼Ÿ 
èµ„æºéœ€è¦é‡Šæ”¾ï¼Œä¸ç„¶å°±å†…å­˜æ³„æ¼
#### åˆç†ä½¿ç”¨defer
å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œè¦åˆ¤æ–­æ˜¯å¦error
### åˆåˆ°è¿›é˜¶éƒ¨åˆ†
å®šä¹‰ï¼šæ¯æ¬¡deferè¯­å¥æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šæŠŠå‡½æ•°å‹æ ˆï¼Œå‡½æ•°å‚æ•°ä¼šè¢«æ‹·è´ä¸‹æ¥ï¼›å½“å¤–å±‚å‡½æ•°(éä»£ç å—ï¼Œå¦‚ä¸€ä¸ªforå¾ªç¯)é€€å‡ºæ—¶ï¼Œdeferå‡½æ•°æŒ‰ç…§å®šä¹‰çš„é€†åºæ‰§è¡Œï¼›å¦‚æœdeferæ‰§è¡Œçš„å‡½æ•°ä¸ºnilï¼Œé‚£ä¹ˆä¼šåœ¨æœ€ç»ˆè°ƒç”¨å‡½æ•°çš„äº§ç”Ÿpanicã€‚<br>
ä»€ä¹ˆæ„æ€ï¼Ÿdeferè¯­å¥ä¸ä¼šé©¬ä¸Šæ‰§è¡Œï¼Œè€Œæ˜¯ä¼šè¿›å…¥ä¸€ä¸ªæ ˆï¼Œå‡½æ•°returnä¹‹å‰ï¼Œä¼šæŒ‰ç…§å…ˆè¿›åå‡ºçš„é¡ºåºæ‰§è¡Œã€‚æœ€å…ˆè¢«å®šä¹‰çš„deferè¯­å¥æœ€åæ‰§è¡Œã€‚å…ˆè¿›åå‡ºåŸå› å°±æ˜¯åé¢å®šä¹‰çš„å‡½æ•°å¯èƒ½ä¼šä¾èµ–å‰é¢çš„èµ„æºï¼Œè‡ªç„¶è¦å…ˆæ‰§è¡Œï¼›å¦åˆ™å¦‚æœå‰é¢å…ˆæ‰§è¡Œäº†ï¼Œé‚£åé¢å‡½æ•°çš„ä¾èµ–å°±æ²¡æœ‰äº†<br>
```go
	var whatever [3]struct{}
	fmt.Println(whatever[2])
	for index,val:=range whatever{
		defer func(){
			fmt.Println(index)
			fmt.Println(val)
		}()
	}
```
deferåé¢ä¼šè·Ÿä¸€ä¸ªclosureï¼Œiæ˜¯å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œæœ€åçš„içš„å€¼æ˜¯2ã€‚<br>
#### åˆ©ç”¨deferåŸç†
æ•…æ„ç”¨åˆ°deferå…ˆæ±‚å€¼ï¼Œå†å»¶è¿Ÿè°ƒç”¨çš„æ€§è´¨ã€‚åœ¨ä¸€ä¸ªå‡½æ•°é‡Œéœ€è¦æ‰“å¼€ä¸¤ä¸ªæ–‡ä»¶è¿›è¡Œåˆå¹¶æ“ä½œï¼Œåˆå¹¶å®Œåï¼Œåœ¨å‡½æ•°æ‰§è¡Œå®Œåå…³é—­æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„

#### deferå‘½ä»¤æ‹†è§£
return xxx=> 1.è¿”å›å€¼ = xxx 2. è°ƒç”¨deferå‡½æ•° 3. è¿”å›ç©ºreturnã€‚<br>
ç¬¬äºŒæ­¥æ˜¯deferå®šä¹‰çš„è¯­å¥ï¼Œè¿™é‡Œå¯èƒ½ä¼šæ“ä½œè¿”å›å€¼<br>
ä¸¾ä¸ªğŸŒ°
```go
func f()(r int){
    t := 5
    defer func(){
        t=t+5
    }()
    return t
}
=>æ‹†è§£å
func f()(r int){
    t := 5
    r = t
    func(){
        t = t+5
    }
    return
}
```
æ‰€ä»¥è¿™é‡Œçš„rå¹¶æ²¡æœ‰å˜æˆ10

#### deferè¯­å¥çš„å‚æ•°
deferè¯­å¥è¡¨è¾¾å¼çš„å€¼åœ¨å®šä¹‰æ—¶å°±å·²ç»ç¡®å®šäº†ã€‚<br>
```go
defer fmt.Println("defer main") // å…¥æ ˆ
	var user = os.Getenv("User_")
	 go func(){
		 defer func(){
			 fmt.Println("defer caller")// å…¥æ ˆ
			 if err := recover();err !=nil{
				 fmt.Println("recover success.err:",err)
			 }
		 }()
		 func(){
			 defer func(){
				 fmt.Println("defer here")// å…¥æ ˆ
			 }()
			 if user == ""{
				 panic("should set user env")
			 }
			 // æ­¤å¤„ä¸æ‰§è¡Œ
			 fmt.Println("after panic")
		 }()
	 }()
	 time.Sleep(100)
	 fmt.Println("end of main function") // ä¸»åç¨‹æ‰§è¡Œ
```